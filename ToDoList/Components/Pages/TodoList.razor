@page "/todo"
@inject ITodoRepository TodoRepository
@rendermode InteractiveServer

<h3>TodoList</h3>

<button class="btn btn-primary" @onclick="AddTodo">Add Todo</button>

@if(todos.Count > 0)
{
    <ul class="list-unstyled">
        @foreach (TodoTask todo in todos)
        {
            <li @key="todo.Id">
                <div class="row mb-2">
                    <div class="col-1" style="width:30px">
                        <input type="checkbox"
                               style="vertical-align:middle"
                               class="form-check-input"
                               @bind-value="todo.IsCompleted"
                               checked="@todo.IsCompleted" />
                    </div>
                    <div class="col">
                        @if (todo.IsCompleted)
                        {
                            <input type="text"
                                   style="vertical-align:middle"
                                   class="form-control border-0 text-decoration-line-through"
                                   @bind-value="todo.Description"
                                   disabled />
                        }
                        else
                        {
                            <input type="text"
                                   style="vertical-align:middle"
                                   class="form-control border-0"
                                   @bind-value="todo.Description" />
                        }

                    </div>
                    <div class="col">
                        @if (todo.IsCompleted)
                        {
                            <text>Completed at: @todo.CompletionDate</text>
                        }
                    </div>
                </div>
            </li>
        }
    </ul>
}
@code {
    private List<TodoTask> todos = new();

    protected override void OnInitialized()
    {
        todos = TodoRepository.GetTodos();
    }

    private void AddTodo()
    {
        TodoTask todo = new TodoTask() { Description = "New task" };
        TodoRepository.AddTodo(todo);
        todos = TodoRepository.GetTodos();
    }
}
